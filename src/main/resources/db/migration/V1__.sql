CREATE TABLE budgyscheme.account
(
    id         BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    created_at TIMESTAMP WITHOUT TIME ZONE,
    updated_at TIMESTAMP WITHOUT TIME ZONE,
    username   VARCHAR(255),
    password   VARCHAR(255),
    CONSTRAINT pk_account PRIMARY KEY (id)
);

CREATE TABLE budgyscheme.category
(
    id         BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    created_at TIMESTAMP WITHOUT TIME ZONE,
    updated_at TIMESTAMP WITHOUT TIME ZONE,
    name       VARCHAR(255),
    account_id BIGINT                                  NOT NULL,
    CONSTRAINT pk_category PRIMARY KEY (id)
);

CREATE TABLE budgyscheme.tbank_import
(
    id                BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    created_at        TIMESTAMP WITHOUT TIME ZONE,
    updated_at        TIMESTAMP WITHOUT TIME ZONE,
    transaction_count INTEGER,
    status            SMALLINT,
    CONSTRAINT pk_tbankimport PRIMARY KEY (id)
);

CREATE TABLE budgyscheme.tbank_transaction
(
    id                       BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    created_at               TIMESTAMP WITHOUT TIME ZONE,
    updated_at               TIMESTAMP WITHOUT TIME ZONE,
    import_id                BIGINT                                  NOT NULL,
    operation_date           TIMESTAMP WITHOUT TIME ZONE,
    payment_date             date,
    card_number              VARCHAR(255),
    status                   VARCHAR(255),
    operation_amount         DECIMAL,
    operation_currency       VARCHAR(255),
    payment_amount           DECIMAL,
    payment_currency         VARCHAR(255),
    cashback                 DECIMAL,
    category                 VARCHAR(255),
    mcc                      INTEGER,
    description              VARCHAR(255),
    bonuses                  DECIMAL,
    investment_rounding      DECIMAL,
    rounded_operation_amount DECIMAL,
    row_hash                 VARCHAR(255),
    CONSTRAINT pk_tbanktransaction PRIMARY KEY (id)
);

CREATE TABLE budgyscheme.transaction
(
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    created_at  TIMESTAMP WITHOUT TIME ZONE,
    updated_at  TIMESTAMP WITHOUT TIME ZONE,
    amount      DECIMAL,
    description VARCHAR(255),
    type        SMALLINT,
    category_id BIGINT                                  NOT NULL,
    account_id  BIGINT                                  NOT NULL,
    CONSTRAINT pk_transaction PRIMARY KEY (id)
);

ALTER TABLE budgyscheme.category
    ADD CONSTRAINT FK_CATEGORY_ON_ACCOUNT FOREIGN KEY (account_id) REFERENCES budgyscheme.account (id);

ALTER TABLE budgyscheme.tbank_transaction
    ADD CONSTRAINT FK_TBANKTRANSACTION_ON_IMPORT FOREIGN KEY (import_id) REFERENCES budgyscheme.tbank_import (id);

ALTER TABLE budgyscheme.transaction
    ADD CONSTRAINT FK_TRANSACTION_ON_ACCOUNT FOREIGN KEY (account_id) REFERENCES budgyscheme.account (id);

ALTER TABLE budgyscheme.transaction
    ADD CONSTRAINT FK_TRANSACTION_ON_CATEGORY FOREIGN KEY (category_id) REFERENCES budgyscheme.category (id);